<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeltaDesk - Complete Data Model Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        nav {
            background: #2d3748;
            color: white;
            padding: 15px 40px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background 0.3s;
            font-size: 0.9em;
        }

        nav a:hover {
            background: #4a5568;
        }

        main {
            padding: 40px;
        }

        section {
            margin-bottom: 60px;
        }

        h2 {
            color: #4a90e2;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #4a90e2;
        }

        h3 {
            color: #357abd;
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        h4 {
            color: #4a5568;
            font-size: 1.2em;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        th {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        tr:hover {
            background: #f7fafc;
        }

        .info-box {
            background: #ebf8ff;
            border-left: 5px solid #4299e1;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: #fffaf0;
            border-left: 5px solid #ed8936;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .success-box {
            background: #f0fff4;
            border-left: 5px solid #48bb78;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .diagram {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            padding: 30px;
            margin: 20px 0;
            border-radius: 8px;
            overflow-x: auto;
        }

        .entity-box {
            display: inline-block;
            background: white;
            border: 2px solid #4a90e2;
            border-radius: 8px;
            padding: 15px;
            margin: 10px;
            min-width: 200px;
            text-align: left;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            vertical-align: top;
        }

        .entity-box h4 {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            margin: -15px -15px 15px -15px;
            padding: 12px 15px;
            border-radius: 6px 6px 0 0;
            font-size: 1em;
        }

        .entity-box ul {
            list-style: none;
            font-size: 0.85em;
        }

        .entity-box li {
            padding: 4px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .entity-box li:last-child {
            border-bottom: none;
        }

        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            margin-left: 5px;
        }

        .nullable { background: #fed7aa; color: #9a3412; }
        .required { background: #bbf7d0; color: #166534; }
        .foreign-key { background: #fecaca; color: #991b1b; }
        .primary-key { background: #c7d2fe; color: #3730a3; }

        .relationship-line {
            display: block;
            text-align: center;
            color: #4a90e2;
            font-size: 0.9em;
            margin: 10px 0;
        }

        .erd-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }

        .erd-group {
            text-align: center;
        }

        .erd-group-label {
            background: #e2e8f0;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 10px;
            display: inline-block;
        }

        footer {
            background: #2d3748;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .enum-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .enum-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
        }

        .enum-card h4 {
            margin-top: 0;
            color: #4a90e2;
            border-bottom: 2px solid #4a90e2;
            padding-bottom: 8px;
        }

        .enum-card ul {
            list-style: none;
            margin-top: 10px;
        }

        .enum-card li {
            padding: 5px 0;
            font-size: 0.9em;
        }

        .enum-card .enum-value {
            background: #4a90e2;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-right: 8px;
        }

        @media (max-width: 768px) {
            .entity-box {
                display: block;
                margin: 20px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>DeltaDesk</h1>
            <p>Complete Data Model & Entity Framework Core Guide</p>
            <p style="font-size: 0.9em; margin-top: 10px; opacity: 0.8;">Monte Carlo Option Pricing & Portfolio Management System</p>
        </header>

        <nav>
            <ul>
                <li><a href="#overview">Overview</a></li>
                <li><a href="#architecture">Architecture</a></li>
                <li><a href="#exchanges">Exchanges</a></li>
                <li><a href="#stocks">Stocks</a></li>
                <li><a href="#options">Options</a></li>
                <li><a href="#portfolios">Portfolios</a></li>
                <li><a href="#trades">Trades</a></li>
                <li><a href="#positions">Positions</a></li>
                <li><a href="#pricing-history">Pricing History</a></li>
                <li><a href="#enums">Enums</a></li>
            </ul>
        </nav>

        <main>
            <!-- OVERVIEW SECTION -->
            <section id="overview">
                <h2>System Overview</h2>

                <p>DeltaDesk is a comprehensive Monte Carlo option pricing and portfolio management system built with .NET 9.0 and Entity Framework Core. It supports trading and pricing of exotic options as well as underlying stocks, with real-time price updates via the Alpaca Markets API.</p>

                <div class="info-box">
                    <h4>Key Technologies</h4>
                    <ul>
                        <li><strong>Framework:</strong> .NET 9.0</li>
                        <li><strong>ORM:</strong> Entity Framework Core 9.0</li>
                        <li><strong>Database:</strong> PostgreSQL 16</li>
                        <li><strong>Provider:</strong> Npgsql.EntityFrameworkCore.PostgreSQL</li>
                        <li><strong>API:</strong> ASP.NET Core Web API</li>
                        <li><strong>Market Data:</strong> Alpaca Markets API</li>
                    </ul>
                </div>

                <h3>Core Features</h3>
                <table>
                    <tr>
                        <th>Feature</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><strong>Multi-Exchange Support</strong></td>
                        <td>Support for multiple stock exchanges (NYSE, NASDAQ, etc.)</td>
                    </tr>
                    <tr>
                        <td><strong>Real-Time Stock Prices</strong></td>
                        <td>Automatic price updates via Alpaca Markets API</td>
                    </tr>
                    <tr>
                        <td><strong>Exotic Options</strong></td>
                        <td>6 option types: European, Asian, Digital, Barrier, Lookback, Range</td>
                    </tr>
                    <tr>
                        <td><strong>Portfolio Management</strong></td>
                        <td>Track positions, cash, and P&L across multiple portfolios</td>
                    </tr>
                    <tr>
                        <td><strong>Trade Recording</strong></td>
                        <td>Buy/sell stocks and options with automatic position updates</td>
                    </tr>
                    <tr>
                        <td><strong>Monte Carlo Pricing</strong></td>
                        <td>Price options with various simulation modes and Greeks calculation</td>
                    </tr>
                    <tr>
                        <td><strong>Pricing History</strong></td>
                        <td>Complete audit trail of all pricing calculations</td>
                    </tr>
                </table>
            </section>

            <!-- ARCHITECTURE SECTION -->
            <section id="architecture">
                <h2>Database Architecture</h2>

                <h3>Entity Relationship Diagram</h3>
                <div class="diagram">
                    <div class="erd-container">
                        <div class="erd-group">
                            <span class="erd-group-label">Market Data</span>
                            <div>
                                <div class="entity-box">
                                    <h4>Exchanges</h4>
                                    <ul>
                                        <li><strong>Id</strong> <span class="tag primary-key">PK</span></li>
                                        <li>Name</li>
                                        <li>Country</li>
                                        <li>Currency</li>
                                    </ul>
                                </div>
                                <div class="relationship-line">1 : Many ↓</div>
                                <div class="entity-box">
                                    <h4>Stocks</h4>
                                    <ul>
                                        <li><strong>Id</strong> <span class="tag primary-key">PK</span></li>
                                        <li>ExchangeId <span class="tag foreign-key">FK</span></li>
                                        <li>Ticker</li>
                                        <li>CurrentPrice</li>
                                    </ul>
                                </div>
                                <div class="relationship-line">1 : Many ↓</div>
                                <div class="entity-box">
                                    <h4>Options</h4>
                                    <ul>
                                        <li><strong>Id</strong> <span class="tag primary-key">PK</span></li>
                                        <li>StockId <span class="tag foreign-key">FK</span></li>
                                        <li>OptionType, Strike</li>
                                        <li>IsCall, ExpiryDate</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="erd-group">
                            <span class="erd-group-label">Portfolio Management</span>
                            <div>
                                <div class="entity-box">
                                    <h4>Portfolios</h4>
                                    <ul>
                                        <li><strong>Id</strong> <span class="tag primary-key">PK</span></li>
                                        <li>Name</li>
                                        <li>Cash</li>
                                        <li>Description</li>
                                    </ul>
                                </div>
                                <div class="relationship-line">1 : Many ↓</div>
                                <div style="display: flex; gap: 10px;">
                                    <div class="entity-box">
                                        <h4>Trades</h4>
                                        <ul>
                                            <li><strong>Id</strong> <span class="tag primary-key">PK</span></li>
                                            <li>PortfolioId <span class="tag foreign-key">FK</span></li>
                                            <li>AssetType</li>
                                            <li>StockId/OptionId <span class="tag foreign-key">FK</span></li>
                                            <li>Quantity, Price</li>
                                        </ul>
                                    </div>
                                    <div class="entity-box">
                                        <h4>Positions</h4>
                                        <ul>
                                            <li><strong>Id</strong> <span class="tag primary-key">PK</span></li>
                                            <li>PortfolioId <span class="tag foreign-key">FK</span></li>
                                            <li>AssetType</li>
                                            <li>StockId/OptionId <span class="tag foreign-key">FK</span></li>
                                            <li>NetQuantity, AvgCost</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="erd-group">
                            <span class="erd-group-label">Pricing Engine</span>
                            <div>
                                <div class="entity-box">
                                    <h4>PricingHistory</h4>
                                    <ul>
                                        <li><strong>Id</strong> <span class="tag primary-key">PK</span></li>
                                        <li>OptionId <span class="tag foreign-key">FK</span></li>
                                        <li>Price, StandardError</li>
                                        <li>Delta, Gamma, Vega</li>
                                        <li>Theta, Rho</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <h4>Key Relationships</h4>
                    <ul>
                        <li><strong>Exchange → Stocks:</strong> One exchange has many stocks</li>
                        <li><strong>Stock → Options:</strong> One stock can have many options</li>
                        <li><strong>Portfolio → Trades:</strong> One portfolio has many trades</li>
                        <li><strong>Portfolio → Positions:</strong> One portfolio has many positions</li>
                        <li><strong>Stock/Option → Trades:</strong> Assets can appear in many trades</li>
                        <li><strong>Stock/Option → Positions:</strong> Assets can appear in many positions</li>
                        <li><strong>Option → PricingHistory:</strong> One option has many pricing records</li>
                    </ul>
                </div>
            </section>

            <!-- EXCHANGES TABLE -->
            <section id="exchanges">
                <h2>Exchanges Table</h2>
                <p>Represents stock exchanges where underlying assets are listed.</p>

                <table>
                    <tr>
                        <th>Column</th>
                        <th>Type</th>
                        <th>Nullable</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><strong>Id</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Primary key, auto-generated</td>
                    </tr>
                    <tr>
                        <td><strong>Name</strong></td>
                        <td>varchar(100)</td>
                        <td>No</td>
                        <td>Exchange name (e.g., "NYSE", "NASDAQ")</td>
                    </tr>
                    <tr>
                        <td><strong>Description</strong></td>
                        <td>varchar(500)</td>
                        <td>Yes</td>
                        <td>Optional description</td>
                    </tr>
                    <tr>
                        <td><strong>Country</strong></td>
                        <td>varchar(100)</td>
                        <td>Yes</td>
                        <td>Country location (e.g., "USA")</td>
                    </tr>
                    <tr>
                        <td><strong>Currency</strong></td>
                        <td>varchar(10)</td>
                        <td>Yes</td>
                        <td>Trading currency (e.g., "USD")</td>
                    </tr>
                    <tr>
                        <td><strong>CreatedAt</strong></td>
                        <td>timestamp</td>
                        <td>No</td>
                        <td>When exchange was added</td>
                    </tr>
                </table>
            </section>

            <!-- STOCKS TABLE -->
            <section id="stocks">
                <h2>Stocks Table</h2>
                <p>Represents underlying assets that can be traded directly or used as option underlyings.</p>

                <table>
                    <tr>
                        <th>Column</th>
                        <th>Type</th>
                        <th>Nullable</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><strong>Id</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Primary key, auto-generated</td>
                    </tr>
                    <tr>
                        <td><strong>ExchangeId</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Foreign key to Exchanges</td>
                    </tr>
                    <tr>
                        <td><strong>Ticker</strong></td>
                        <td>varchar(10)</td>
                        <td>No</td>
                        <td>Stock symbol (e.g., "AAPL")</td>
                    </tr>
                    <tr>
                        <td><strong>Name</strong></td>
                        <td>varchar(200)</td>
                        <td>No</td>
                        <td>Company name</td>
                    </tr>
                    <tr>
                        <td><strong>CurrentPrice</strong></td>
                        <td>double</td>
                        <td>No</td>
                        <td>Current market price (auto-updated via Alpaca)</td>
                    </tr>
                    <tr>
                        <td><strong>Description</strong></td>
                        <td>varchar(500)</td>
                        <td>Yes</td>
                        <td>Optional notes</td>
                    </tr>
                    <tr>
                        <td><strong>CreatedAt</strong></td>
                        <td>timestamp</td>
                        <td>No</td>
                        <td>When stock was added</td>
                    </tr>
                    <tr>
                        <td><strong>UpdatedAt</strong></td>
                        <td>timestamp</td>
                        <td>Yes</td>
                        <td>Last price update time</td>
                    </tr>
                </table>

                <div class="success-box">
                    <h4>Price Updates</h4>
                    <p>Stock prices are automatically updated every 5 minutes via the Alpaca Markets API background service. The <code>UpdatedAt</code> timestamp reflects the last successful price fetch.</p>
                </div>
            </section>

            <!-- OPTIONS TABLE -->
            <section id="options">
                <h2>Options Table</h2>
                <p>Represents option contracts with type-specific parameters stored in nullable columns.</p>

                <h3>Core Fields (Always Required)</h3>
                <table>
                    <tr>
                        <th>Column</th>
                        <th>Type</th>
                        <th>Nullable</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><strong>Id</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Primary key, auto-generated</td>
                    </tr>
                    <tr>
                        <td><strong>StockId</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Foreign key to underlying Stock</td>
                    </tr>
                    <tr>
                        <td><strong>OptionType</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Enum: 0=European, 1=Asian, 2=Digital, 3=Barrier, 4=Lookback, 5=Range</td>
                    </tr>
                    <tr>
                        <td><strong>Strike</strong></td>
                        <td>double</td>
                        <td>No</td>
                        <td>Strike price</td>
                    </tr>
                    <tr>
                        <td><strong>IsCall</strong></td>
                        <td>boolean</td>
                        <td>No</td>
                        <td>True = Call, False = Put</td>
                    </tr>
                    <tr>
                        <td><strong>ExpiryDate</strong></td>
                        <td>timestamp</td>
                        <td>No</td>
                        <td>Option expiration date</td>
                    </tr>
                    <tr>
                        <td><strong>CreatedAt</strong></td>
                        <td>timestamp</td>
                        <td>No</td>
                        <td>When option was created</td>
                    </tr>
                    <tr>
                        <td><strong>UpdatedAt</strong></td>
                        <td>timestamp</td>
                        <td>Yes</td>
                        <td>Last modification time</td>
                    </tr>
                </table>

                <h3>Type-Specific Fields (Nullable)</h3>
                <table>
                    <tr>
                        <th>Column</th>
                        <th>Type</th>
                        <th>Used By</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><strong>AveragingType</strong></td>
                        <td>integer?</td>
                        <td>Asian</td>
                        <td>0=Arithmetic, 1=Geometric</td>
                    </tr>
                    <tr>
                        <td><strong>ObservationFrequency</strong></td>
                        <td>integer?</td>
                        <td>Asian</td>
                        <td>Observations per year (e.g., 252)</td>
                    </tr>
                    <tr>
                        <td><strong>DigitalCondition</strong></td>
                        <td>integer?</td>
                        <td>Digital</td>
                        <td>0=AboveStrike, 1=BelowStrike</td>
                    </tr>
                    <tr>
                        <td><strong>BarrierOptionType</strong></td>
                        <td>integer?</td>
                        <td>Barrier</td>
                        <td>0=KnockOut, 1=KnockIn</td>
                    </tr>
                    <tr>
                        <td><strong>BarrierDir</strong></td>
                        <td>integer?</td>
                        <td>Barrier</td>
                        <td>0=Up, 1=Down</td>
                    </tr>
                    <tr>
                        <td><strong>BarrierLevel</strong></td>
                        <td>double?</td>
                        <td>Barrier</td>
                        <td>Barrier price level</td>
                    </tr>
                    <tr>
                        <td><strong>LookbackOptionType</strong></td>
                        <td>integer?</td>
                        <td>Lookback</td>
                        <td>0=FloatingStrike, 1=FixedStrike</td>
                    </tr>
                    <tr>
                        <td><strong>RangeObservationFrequency</strong></td>
                        <td>integer?</td>
                        <td>Range</td>
                        <td>Observations for range calculation</td>
                    </tr>
                </table>
            </section>

            <!-- PORTFOLIOS TABLE -->
            <section id="portfolios">
                <h2>Portfolios Table</h2>
                <p>Represents a collection of positions with associated cash balance.</p>

                <table>
                    <tr>
                        <th>Column</th>
                        <th>Type</th>
                        <th>Nullable</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><strong>Id</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Primary key, auto-generated</td>
                    </tr>
                    <tr>
                        <td><strong>Name</strong></td>
                        <td>varchar(200)</td>
                        <td>No</td>
                        <td>Portfolio name</td>
                    </tr>
                    <tr>
                        <td><strong>Description</strong></td>
                        <td>varchar(1000)</td>
                        <td>Yes</td>
                        <td>Optional description</td>
                    </tr>
                    <tr>
                        <td><strong>Cash</strong></td>
                        <td>double</td>
                        <td>No</td>
                        <td>Available cash balance (updated on trades)</td>
                    </tr>
                    <tr>
                        <td><strong>CreatedAt</strong></td>
                        <td>timestamp</td>
                        <td>No</td>
                        <td>When portfolio was created</td>
                    </tr>
                    <tr>
                        <td><strong>UpdatedAt</strong></td>
                        <td>timestamp</td>
                        <td>Yes</td>
                        <td>Last modification time</td>
                    </tr>
                </table>

                <div class="info-box">
                    <h4>Cash Management</h4>
                    <p>The Cash field is automatically adjusted when trades are executed:</p>
                    <ul>
                        <li><strong>Buy:</strong> Cash decreases by (Quantity × Price)</li>
                        <li><strong>Sell:</strong> Cash increases by (Quantity × Price)</li>
                    </ul>
                </div>
            </section>

            <!-- TRADES TABLE -->
            <section id="trades">
                <h2>Trades Table</h2>
                <p>Records individual buy/sell transactions for both stocks and options.</p>

                <table>
                    <tr>
                        <th>Column</th>
                        <th>Type</th>
                        <th>Nullable</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><strong>Id</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Primary key, auto-generated</td>
                    </tr>
                    <tr>
                        <td><strong>PortfolioId</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Foreign key to Portfolio</td>
                    </tr>
                    <tr>
                        <td><strong>AssetType</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>0=Stock, 1=Option</td>
                    </tr>
                    <tr>
                        <td><strong>StockId</strong></td>
                        <td>integer?</td>
                        <td>Yes</td>
                        <td>FK to Stock (if AssetType=Stock)</td>
                    </tr>
                    <tr>
                        <td><strong>OptionId</strong></td>
                        <td>integer?</td>
                        <td>Yes</td>
                        <td>FK to Option (if AssetType=Option)</td>
                    </tr>
                    <tr>
                        <td><strong>TradeType</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>0=Buy, 1=Sell, 2=Close</td>
                    </tr>
                    <tr>
                        <td><strong>Quantity</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Number of shares/contracts</td>
                    </tr>
                    <tr>
                        <td><strong>Price</strong></td>
                        <td>double</td>
                        <td>No</td>
                        <td>Price per share/contract</td>
                    </tr>
                    <tr>
                        <td><strong>TotalCost</strong></td>
                        <td>double</td>
                        <td>No</td>
                        <td>Quantity × Price (with sign)</td>
                    </tr>
                    <tr>
                        <td><strong>Notes</strong></td>
                        <td>varchar(1000)</td>
                        <td>Yes</td>
                        <td>Optional trade notes</td>
                    </tr>
                    <tr>
                        <td><strong>TradeDate</strong></td>
                        <td>timestamp</td>
                        <td>No</td>
                        <td>When trade was executed</td>
                    </tr>
                    <tr>
                        <td><strong>CreatedAt</strong></td>
                        <td>timestamp</td>
                        <td>No</td>
                        <td>When record was created</td>
                    </tr>
                </table>

                <div class="warning-box">
                    <h4>Asset Type Constraint</h4>
                    <p>Either <code>StockId</code> or <code>OptionId</code> must be populated based on <code>AssetType</code>:</p>
                    <ul>
                        <li>If AssetType = 0 (Stock): StockId is required, OptionId is NULL</li>
                        <li>If AssetType = 1 (Option): OptionId is required, StockId is NULL</li>
                    </ul>
                </div>
            </section>

            <!-- POSITIONS TABLE -->
            <section id="positions">
                <h2>Positions Table</h2>
                <p>Materialized view of current holdings, automatically updated when trades are recorded.</p>

                <table>
                    <tr>
                        <th>Column</th>
                        <th>Type</th>
                        <th>Nullable</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><strong>Id</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Primary key, auto-generated</td>
                    </tr>
                    <tr>
                        <td><strong>PortfolioId</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Foreign key to Portfolio</td>
                    </tr>
                    <tr>
                        <td><strong>AssetType</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>0=Stock, 1=Option</td>
                    </tr>
                    <tr>
                        <td><strong>StockId</strong></td>
                        <td>integer?</td>
                        <td>Yes</td>
                        <td>FK to Stock (if AssetType=Stock)</td>
                    </tr>
                    <tr>
                        <td><strong>OptionId</strong></td>
                        <td>integer?</td>
                        <td>Yes</td>
                        <td>FK to Option (if AssetType=Option)</td>
                    </tr>
                    <tr>
                        <td><strong>NetQuantity</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Current position size (+long, -short, 0=closed)</td>
                    </tr>
                    <tr>
                        <td><strong>AverageCost</strong></td>
                        <td>double</td>
                        <td>No</td>
                        <td>Average cost per share/contract</td>
                    </tr>
                    <tr>
                        <td><strong>TotalCost</strong></td>
                        <td>double</td>
                        <td>No</td>
                        <td>Total cost basis</td>
                    </tr>
                    <tr>
                        <td><strong>LastUpdated</strong></td>
                        <td>timestamp</td>
                        <td>No</td>
                        <td>Last trade affecting this position</td>
                    </tr>
                    <tr>
                        <td><strong>CreatedAt</strong></td>
                        <td>timestamp</td>
                        <td>No</td>
                        <td>When position was first opened</td>
                    </tr>
                </table>

                <div class="success-box">
                    <h4>Automatic Position Management</h4>
                    <p>Positions are automatically created and updated when trades are recorded:</p>
                    <ul>
                        <li><strong>New Trade for New Asset:</strong> Creates new position record</li>
                        <li><strong>Trade for Existing Position:</strong> Updates NetQuantity, recalculates AverageCost</li>
                        <li><strong>Position Closed:</strong> NetQuantity becomes 0 (record retained for history)</li>
                    </ul>
                </div>
            </section>

            <!-- PRICING HISTORY TABLE -->
            <section id="pricing-history">
                <h2>PricingHistory Table</h2>
                <p>Complete audit trail of all option pricing calculations with Greeks.</p>

                <h3>Identification & Parameters</h3>
                <table>
                    <tr>
                        <th>Column</th>
                        <th>Type</th>
                        <th>Nullable</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><strong>Id</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Primary key, auto-generated</td>
                    </tr>
                    <tr>
                        <td><strong>OptionId</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Foreign key to Option (CASCADE delete)</td>
                    </tr>
                    <tr>
                        <td><strong>InitialPrice</strong></td>
                        <td>double</td>
                        <td>No</td>
                        <td>Stock price used for pricing</td>
                    </tr>
                    <tr>
                        <td><strong>Volatility</strong></td>
                        <td>double</td>
                        <td>No</td>
                        <td>Annualized volatility (σ)</td>
                    </tr>
                    <tr>
                        <td><strong>RiskFreeRate</strong></td>
                        <td>double</td>
                        <td>No</td>
                        <td>Risk-free rate (r)</td>
                    </tr>
                    <tr>
                        <td><strong>TimeToExpiry</strong></td>
                        <td>double</td>
                        <td>No</td>
                        <td>Time to expiration in years</td>
                    </tr>
                    <tr>
                        <td><strong>TimeSteps</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Number of simulation time steps</td>
                    </tr>
                    <tr>
                        <td><strong>NumberOfPaths</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Number of Monte Carlo paths</td>
                    </tr>
                    <tr>
                        <td><strong>SimMode</strong></td>
                        <td>integer</td>
                        <td>No</td>
                        <td>Simulation mode (0-4)</td>
                    </tr>
                    <tr>
                        <td><strong>UseMultithreading</strong></td>
                        <td>boolean</td>
                        <td>No</td>
                        <td>Whether parallel execution was used</td>
                    </tr>
                </table>

                <h3>Results & Greeks</h3>
                <table>
                    <tr>
                        <th>Column</th>
                        <th>Type</th>
                        <th>Nullable</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><strong>Price</strong></td>
                        <td>double</td>
                        <td>No</td>
                        <td>Calculated option price</td>
                    </tr>
                    <tr>
                        <td><strong>StandardError</strong></td>
                        <td>double</td>
                        <td>No</td>
                        <td>Monte Carlo standard error</td>
                    </tr>
                    <tr>
                        <td><strong>ExecutionTimeMs</strong></td>
                        <td>double</td>
                        <td>No</td>
                        <td>Computation time in milliseconds</td>
                    </tr>
                    <tr>
                        <td><strong>Delta</strong></td>
                        <td>double?</td>
                        <td>Yes</td>
                        <td>∂V/∂S - Price sensitivity to underlying</td>
                    </tr>
                    <tr>
                        <td><strong>Gamma</strong></td>
                        <td>double?</td>
                        <td>Yes</td>
                        <td>∂²V/∂S² - Rate of change of Delta</td>
                    </tr>
                    <tr>
                        <td><strong>Vega</strong></td>
                        <td>double?</td>
                        <td>Yes</td>
                        <td>∂V/∂σ - Volatility sensitivity</td>
                    </tr>
                    <tr>
                        <td><strong>Theta</strong></td>
                        <td>double?</td>
                        <td>Yes</td>
                        <td>∂V/∂t - Time decay</td>
                    </tr>
                    <tr>
                        <td><strong>Rho</strong></td>
                        <td>double?</td>
                        <td>Yes</td>
                        <td>∂V/∂r - Interest rate sensitivity</td>
                    </tr>
                    <tr>
                        <td><strong>PricedAt</strong></td>
                        <td>timestamp</td>
                        <td>No</td>
                        <td>When pricing was performed</td>
                    </tr>
                    <tr>
                        <td><strong>RequestSource</strong></td>
                        <td>text?</td>
                        <td>Yes</td>
                        <td>Source identifier (e.g., "API", "GUI")</td>
                    </tr>
                </table>
            </section>

            <!-- ENUMS SECTION -->
            <section id="enums">
                <h2>Enumerations</h2>
                <p>All enums are stored as integers in the database.</p>

                <div class="enum-grid">
                    <div class="enum-card">
                        <h4>OptionType</h4>
                        <ul>
                            <li><span class="enum-value">0</span> European</li>
                            <li><span class="enum-value">1</span> Asian</li>
                            <li><span class="enum-value">2</span> Digital</li>
                            <li><span class="enum-value">3</span> Barrier</li>
                            <li><span class="enum-value">4</span> Lookback</li>
                            <li><span class="enum-value">5</span> Range</li>
                        </ul>
                    </div>

                    <div class="enum-card">
                        <h4>AssetType</h4>
                        <ul>
                            <li><span class="enum-value">0</span> Stock</li>
                            <li><span class="enum-value">1</span> Option</li>
                        </ul>
                    </div>

                    <div class="enum-card">
                        <h4>TradeType</h4>
                        <ul>
                            <li><span class="enum-value">0</span> Buy</li>
                            <li><span class="enum-value">1</span> Sell</li>
                            <li><span class="enum-value">2</span> Close</li>
                        </ul>
                    </div>

                    <div class="enum-card">
                        <h4>AveragingType (Asian)</h4>
                        <ul>
                            <li><span class="enum-value">0</span> Arithmetic</li>
                            <li><span class="enum-value">1</span> Geometric</li>
                        </ul>
                    </div>

                    <div class="enum-card">
                        <h4>ConditionType (Digital)</h4>
                        <ul>
                            <li><span class="enum-value">0</span> AboveStrike</li>
                            <li><span class="enum-value">1</span> BelowStrike</li>
                        </ul>
                    </div>

                    <div class="enum-card">
                        <h4>BarrierType</h4>
                        <ul>
                            <li><span class="enum-value">0</span> KnockOut</li>
                            <li><span class="enum-value">1</span> KnockIn</li>
                        </ul>
                    </div>

                    <div class="enum-card">
                        <h4>BarrierDirection</h4>
                        <ul>
                            <li><span class="enum-value">0</span> Up</li>
                            <li><span class="enum-value">1</span> Down</li>
                        </ul>
                    </div>

                    <div class="enum-card">
                        <h4>LookbackType</h4>
                        <ul>
                            <li><span class="enum-value">0</span> FloatingStrike</li>
                            <li><span class="enum-value">1</span> FixedStrike</li>
                        </ul>
                    </div>

                    <div class="enum-card">
                        <h4>SimMode</h4>
                        <ul>
                            <li><span class="enum-value">0</span> Plain Monte Carlo</li>
                            <li><span class="enum-value">1</span> Antithetic Variates</li>
                            <li><span class="enum-value">2</span> Control Variates</li>
                            <li><span class="enum-value">3</span> Antithetic + Control</li>
                            <li><span class="enum-value">4</span> Quasi-Random (Van Der Corput)</li>
                        </ul>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p><strong>DeltaDesk</strong> - Monte Carlo Option Pricing & Portfolio Management</p>
            <p>.NET 9.0 | Entity Framework Core | PostgreSQL 16 | Alpaca Markets API</p>
            <p style="margin-top: 10px; opacity: 0.7;">Last Updated: November 2024</p>
        </footer>
    </div>
</body>
</html>
